---
title: "Project Draft"
date: 'Due: October 30, 11:59pm'
output:
  pdf_document: default
  html_document: default
authors: Alexis Bianco, Pierce Hollier, Hadeel Hamoud, Ryan Lee
---

```{r loading-pack-reading-data, message=FALSE, warning=FALSE}
library(tidyverse)
library(broom)
climate <- read_csv("data/climate.data.processed.csv")
```

### Introduction and Data

As the world struggles to convince so many people about the urgency of climate change it needs to be known that the threat we face is not just that of rising sea levels or CO2 levels—it is that of losing our homes. It is that of entire cities having to uproot and move elsewhere because they can no longer sustain themselves. Far from just a small increase in temperature, but a disruption of our lives as we know it.

Each year, tens of millions of people are driven from their homes by floods, storms, and droughts. The Ecological Threat Register, conducted by The Sydney-based Institute for Economics and Peace (IEP), measures ecological threats over 157 independent states and territories. The report projects that as many as 1.2 billion people around the world could be displaced by 2050 (Institute for Economics and Peace, 2020). The adverse effects of global climate change will induce more extreme weather, growing food and water insecurity, and rising sea levels which will cause the number of displaced people to rise (UNHCR, 2019). The IEP report additionally identifies three clusters of ecological hotspots: the Sahel-Horn belt of Africa, from Mauritania to Somalia; the Southern African belt, from Angola to Madagascar, and the Middle East and Central Asian belt, from Syria to Pakistan.

The intersection of climate change and migration requires comprehensive data analysis and solutions to the multidimensional challenges it creates (Podesta, 2019). Therefore, analyzing the dynamics between climate change indicators and displaced people not due to conflict can reveal opportunities for interventions.

Our primary goal in this project is to understand the correlation between climate change indicators and the refugee flow from at-risk countries. In order to make the analysis more manageable, we will focus on the climate change and refugee data of the Middle East region.

According to the WBD (World Bank Database), most of the data from the data set comes directly from each country in the World Bank Group’s national statistical systems. The data itself contains many variables, and the series name tells us the metric for which we are getting data. Within each series, the data is broken down into the data for each nation, and each row below the country name corresponds with that country's data for that series name for each year between 1980-2029. This data set contains all the markers that the WDB has tracked in association with climate change in almost every country on Earth. This includes variables such as CO2 emissions levels of every country and agricultural output of each country. Unfortunately, the WDB does not have very complete data for some of the variables. However, we will focus mainly on variables that have sufficient data points, unless the variable is unlikely to change much over time, in which case we have decided to turn these into binary variables. 

We will start by examining variables in the WDB data that scientific literature identifies as climate change predictors such as CO2 emissions (as measured in kiltons), other greenhouse emissions (in kilotons), and percentage of arable land as well as overall refugee flow out of the countries. Then, we will analyze the correlation between displacement and climate indicators. The predictors will be used to build a linear model that attempts to explain some of the variance in refugee flow. While refugee flow from a country can be influenced by an almost innumerable amount of variables, the hope for the project is not predict all of that variance. A model that is able to significantly predict 20% of the variance in refugee flow would be a useful result. We hypothesize that CO2 emissions (as measured in kilotons), other greenhouse emissions (in kilotons), and percentage of arable land will be able to explain, with statistical significance, at least 15% of the variance in refugee flow from countries in the Middle East and Central Asian Belt, an at-risk region identified by The Ecological Threat Register.

### Methodology

To visualize climate change predictors within each Middle Eastern country over time, we plotted the yearly CO2 emissions, N2O emissions, methane emissions, etc. We also plotted the yearly number of internally displaced people due to natural disaster and number of refugees by country of origin according to the World Bank.

```{r data-processing, warning=F, message = F, echo=FALSE}
climate <- climate %>%
  mutate(access_clean_fuels = as.numeric(`Access to clean fuels and technologies for cooking (% of population) [EG.CFT.ACCS.ZS]`),
         access_electricity = as.numeric(`Access to electricity (% of population) [EG.ELC.ACCS.ZS]`),
         agr_land = as.numeric(`Agricultural land (% of land area) [AG.LND.AGRI.ZS]`),
         agr_methane = as.numeric(`Agricultural methane emissions (% of total) [EN.ATM.METH.AG.ZS]`),
         agr_methane_tons = as.numeric(`Agricultural methane emissions (thousand metric tons of CO2 equivalent) [EN.ATM.METH.AG.KT.CE]`),
         agr_nitrous = as.numeric(`Agricultural nitrous oxide emissions (% of total) [EN.ATM.NOXE.AG.ZS]`),
       agr_nitrous_tons = as.numeric(`Agricultural nitrous oxide emissions (thousand metric tons of CO2 equivalent) [EN.ATM.NOXE.AG.KT.CE]`),
         arable_land = as.numeric(`Arable land (% of land area) [AG.LND.ARBL.ZS]`),
         avg_precip = as.numeric(`Average precipitation in depth (mm per year) [AG.LND.PRCP.MM]`),
         co2_tons = as.numeric(`CO2 emissions (metric tons per capita) [EN.ATM.CO2E.PC]`),
         co2_kt = as.numeric(`CO2 emissions (kt) [EN.ATM.CO2E.KT]`),
       access_electricity = as.numeric(`Access to electricity (% of population) [EG.ELC.ACCS.ZS]`),
         forest_area = as.numeric(`Forest area (% of land area) [AG.LND.FRST.ZS]`),
         fossil_fuel = as.numeric(`Fossil fuel energy consumption (% of total) [EG.USE.COMM.FO.ZS]`),
         internal_displace = as.numeric(`Internally displaced persons, new displacement associated with disasters (number of cases) [VC.IDP.NWDS]`),
         land_cereal = as.numeric(`Land under cereal production (hectares) [AG.LND.CREL.HA]`),
       forest_area = as.numeric(`Forest area (% of land area) [AG.LND.FRST.ZS]`),
         nitrous_tons = as.numeric(`Nitrous oxide emissions (thousand metric tons of CO2 equivalent) [EN.ATM.NOXE.KT.CE]`),
         othergas = as.numeric(`Other greenhouse gas emissions, HFC, PFC and SF6 (thousand metric tons of CO2 equivalent) [EN.ATM.GHGO.KT.CE]`),
       pm2.5_mean = as.numeric(`PM2.5 air pollution, mean annual exposure (micrograms per cubic meter) [EN.ATM.PM25.MC.M3]`),
       pm2.5_who = as.numeric(`PM2.5 air pollution, population exposed to levels exceeding WHO guideline value (% of total) [EN.ATM.PM25.MC.ZS]`),
         methane_kt = as.numeric(`Methane emissions (kt of CO2 equivalent) [EN.ATM.METH.KT.CE]`),
         methane_tons = as.numeric(`Methane emissions in energy sector (thousand metric tons of CO2 equivalent) [EN.ATM.METH.EG.KT.CE]`),
         refugee = as.numeric(`Refugee population by country or territory of origin [SM.POP.REFG.OR]`),
         sf6gas = as.numeric(`SF6 gas emissions (thousand metric tons of CO2 equivalent) [EN.ATM.SF6G.KT.CE]`),
        pop = as.numeric(`Population, total [SP.POP.TOTL]`),
       total_gas = as.numeric(`Total greenhouse gas emissions (kt of CO2 equivalent) [EN.ATM.GHGT.KT.CE]`))%>%
  mutate(prop_refugee = refugee/pop) %>% 
  select(`Time`, `Country Name`, arable_land, land_cereal, co2_tons, nitrous_tons, methane_tons, refugee, pop, prop_refugee)

climate_data <- climate %>%
  filter(`Country Name` == "Afghanistan" | `Country Name` == "Iran, Islamic Rep." |
         `Country Name` == "Iraq" | `Country Name` == "Syrian Arab Republic" |
         `Country Name` == "Pakistan" )
```

```{r climate-predictors-visualizations, eval=FALSE}
# refugee -----------

climate_refugee <- climate_data %>%
  select(`Time`, `Country Name`, refugee)%>%
  filter(refugee != is.na(refugee)) 

ggplot(data = climate_refugee, mapping = aes(x = `Time`,
                                             y= refugee,
                                      color = `Country Name`, 
                                      fill = `Country Name`)) + 
  #facet_wrap( ~ `Country Name`) +
  geom_line() +
  labs(x = "Year", y = "Refugees by Country of Origin", 
       title = "Graph 1: Number of refugees in Iran and Pakistan remained relatively similar while those in Afghanistan, Syria, and Iraq increased corresponding to periods of conflict")

# co2 -----------

climate_co2 <-climate_data %>%
  select(`Time`, `Country Name`, co2_tons)%>%
  filter(co2_tons != is.na(co2_tons)) 

ggplot(data = climate_co2, mapping = aes(x = `Time`,
                                             y= co2_tons,
                                      color = `Country Name`, 
                                      fill = `Country Name`)) + 
  geom_line() +
  labs(x = "Year", y = "CO2 Emissions in Metric Tons per Capita", 
       title = "CO2 emissions in Iran sharply increase after 1980")

# methane -----------

climate_methane <- climate_data %>%
  select(`Time`, `Country Name`, methane_tons)%>%
  filter(methane_tons != is.na(methane_tons)) 

ggplot(data = climate_methane, mapping = aes(x = `Time`,
                                             y= methane_tons,
                                      color = `Country Name`, 
                                      fill = `Country Name`)) + 
  geom_line() +
  labs(x = "Year", y = "Mehtane Emissions in Metric Tons per Capita", 
       title = "Title")

# nitrous ----------

climate_methane <- climate_data %>%
  select(`Time`, `Country Name`, nitrous_tons) %>%
  filter(nitrous_tons != is.na(nitrous_tons))

ggplot(data = climate_methane, mapping = aes(x = `Time`, y = nitrous_tons,
                                             color = `Country Name`,
                                             fill = `Country Name`)) +
  geom_line() + 
  labs(x = "Year", y = "Nitrous Emissions in Metric Tons per Capita",
       title = "Title")

# arable_land ----------

climate_arable <- climate_data %>%
  select(`Time`, `Country Name`, arable_land) %>%
  filter(arable_land != is.na(arable_land))

ggplot(data = climate_arable, mapping = aes(x = `Time`, y = arable_land,
                                             color = `Country Name`,
                                             fill = `Country Name`)) +
  geom_line() + 
  labs(x = "Year", y = "Arable Land in Percent Per Land Area",
       title = "Title")

# land_cereal ----------

climate_cereal <- climate_data %>%
  select(`Time`, `Country Name`, land_cereal) %>%
  filter(land_cereal != is.na(land_cereal))

ggplot(data = climate_cereal, mapping = aes(x = `Time`, y = land_cereal,
                                             color = `Country Name`,
                                             fill = `Country Name`)) +
  geom_line() + 
  labs(x = "Year", y = "Land Under Cereal Production (Hectacres)",
       title = "Title")

#Look into taking out Afghanistan, Syria, Iraq and justify
```

In order to analyze our data, we will run multiple linear regressions on internally displaced people associated with disasters and other variables that have been associated with displacement. We will look at regions of countries in the world in order to make the data analysis easier for us. We would like to see which variables are predictors of internal displacement. Seeing these predictors will allow us to easily see which variables are associated with high amounts of displacement due to disaster. Some of the variables that we will focus on include annual rainfall, agricultural yield, and the percentage of land that is low-lying in the country. For some of the variables with fewer data points but are unlikely to change over the past 20 years, such as the percentage of land that is low-lying, we will turn these variables into binary categorical variables. This will allow us to use these variables in our data analysis. 

Once we identify some of the better predictors of displacement, we would like to run two sample hypothesis tests to see if there are differences in certain variables in countries that are prone to displacement. Specifically, we could run two sample hypothesis tests between high- and low-displacement regions as mentioned in the introduction with relation to certain predictor variables. This way, we could see the extent to how different these variables are for these two classifications. Additionally, we would like to run a Chi-Squared test on the displacement due to disasters and displacement due to conflict. We would like to run this test because it can help us elucidate whether these displacements are related. We would run this test because, if there is a high amount of displacement due to conflict, this could affect the displacement due to disaster, so we would want to see if these variables are independent. 


```{r linear-regression-model, eval=FALSE}
#region_climate <- climate %>% 
  #filter(`Country Name` == "Pakistan")

climate_model <- lm(log(refugee) ~ arable_land + land_cereal + co2_tons + 
                      nitrous_tons + methane_tons,
                    data = climate_data)
tidy(climate_model)

climate_model_aug <- augment(climate_model)
climate_model_aug 

glance(climate_model)%>%
  pull(r.squared)

#Look into using refugee/population rather than raw refugee data
#Worth conducting model with interactions; Look at p-values for interactions
#Confidence intervals would be good to see if they could be zero

#FURTHER MODELS/TESTING
#Look at correlations between predictors; Mention in limitation section: Multicollinearity exists among predictor variables
#Apply equation to different country; could try to predict a country outside the region and see how well the model predicts refugee numbers
#Compare refugee numbers between countries from other regions with different climate but that have similar economic status
#Put refugees in terms of country population and conducting 2 sample t.test; filter out periods of war 
```

Since the dataset includes many different predictor variables, it was first necessary to understand which would be the most powerful holding the others constant. In order to make inferences in regression, certain conditions must be met. In order to simplify the process, a simple model with one predictor and one response was created. The first two are linearity which requires that the relationship between the variables and the predictor be linear and equal variance which means that residuals have relatively constant variance. These conditions were checked by creating a basic linear model and plotting the residuals such that we could examine their variance and linearity.

```{r residual-fitted-plot, eval= FALSE}
ggplot(climate_model_aug, mapping = aes(x = .fitted, y = .std.resid)) +
  geom_point() + 
  geom_hline(yintercept = 0, lwd = 2, col = "red", lty = 2) +
  labs(x = "Value", y = "Residuals")

```

The next is independence which requires that the residuals be independent.  This is checked very easily by simply plotting all the residuals on a graph. 

```{r residual-plot, eval= FALSE}

ggplot(data = climate_model_aug, 
       aes(x = 1:nrow(region_climate), 
           y = .resid)) + 
  geom_point() + 
  labs(x = "Index", y = "Residual")
```

The next requirement is that of normality. The checks for this involved both a plotting of the residuals on a histogram as well as the creation of a Q-Q plot. The histogram was examined for a potential relationship between the residuals and the fit of the model to the qq line was checked too. 

```{r normality-qq-histogram, eval = FALSE}
ggplot(climate_model_aug, mapping = aes(sample = .std.resid)) +
  stat_qq() + 
  stat_qq_line()

ggplot(climate_model_aug, mapping = aes(x = .std.resid)) +
  geom_histogram() + 
  labs(x = "Residuals")
```

Given that the data passed these conditions checks we decided to perform them with a much more complicated model in order to observe the power of our predictors in the presence of each other.  


```{r, eval =FALSE}
climateData2 <- climateData %>% 
  filter(`Series Name` == "CO2 emissions (metric tons per capita)" | 
           `Series Name` == "Net migration" ) 
  #filter("")

climate2 <- data.frame(t(climateData2[-1]))
#climate2 %>% 
 # filter()

```

### Results



### Discussion

Given the rapidly accelerating nature of climate change, it is imperative that more data analysis be done on the massive impacts it has. Our goal was to see what climate change factors like CO2 emissions and agricultural outputs would influence refugee flow from a country. Refugee flow was picked as a terminal measure of climate change impacts on a country. With so many people denying that climate change impacts their lives because it just makes some days hotter, we decided to show a very concrete and serious impact on the lives of millions of people.  Using a linear model allowed us to see not only the direct effects of several different variables all at play at once, but also their interactions. In all of the countries we analyzed, climate change was not the only factor that influenced refugee flow. However, the ability to explain even 20% of the variance in something as intensely complicated as refugee flow with a linear model would be quite the feat. In this experiment we were actually able to obtain and adjusted R squared of ADJ R SQUARED HERE. GOOD result: This was surprising and could be due to LIMITATIONS, but the conditions for inference were mostly satisfied leading us to believe we had constructed a robust model. BAD result: While we were not able to construct a model that explained a significant amount of the variance in refugee flow, this was still a good exercise in trying to uncover relationships that could help the general understanding of migration. 

Our variables were X X X X X. Some like X and X were chosen because they are very obvious markers of human impact on the climate. Additionally X and X were chose because they are downstream markers of anthropogenic climate change that are closer to affecting human lives. There was also an interaction effect between X and X measured for THIS REASON. 

The significance of the main effects for X X X were Y Y Y respectively. These are great results indicating there likely is a relationship between these variables and refugee flow. 

Overall, this not only served as an excellent exercise for us in applying linear regression to the real world, but also can act as the basis for future work trying to develop a quantitative prediction of refugee flow in the future. 

Limitations and Concerns: The main concern with the validity of our models here was the lack of data. The World Bank data which was used was missing for several years and we had to develop our regional groupings due to lack of collation on the part of the World Bank. Moreover, robust, comprehensive data on refugee populations from each country doesn't begin until the late 1980s and early 1990s whereas other metrics such as carbon dioxide emissions begin in the 1960s. In addition to the lack of data, the data on refugee populations was a raw sum and didn't disaggregate the data based on reason for refugee status. Further studies on the relationship between climate predictors and displaced populations should look at refugees and displaced people due to climate change. Though the World Bank data includes data for internally displaced people due to disasters, this metric lacks enough data for analysis.  
